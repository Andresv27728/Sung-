
import { unlinkSync, existsSync, readFileSync } from 'fs'

let handler = async (m, { conn, text, usedPrefix, command }) => {
  if (!text) {
    return m.reply(`âŒ Especifica el nombre del comando a eliminar

ğŸ“ *Uso:* ${usedPrefix + command} <nombre>

ğŸ“Œ *Ejemplo:* ${usedPrefix + command} micomando

ğŸ’¡ *Tip:* Usa ${usedPrefix}listcmd para ver comandos disponibles`)
  }

  const nombre = text.trim().toLowerCase()
  const pluginFiles = ['plugins/', 'plugins/'].map(dir => 
    ['main', 'info', 'ai', 'anime', 'owner', 'grupo', 'grupo-admin', 
     'descargas', 'tools', 'fun', 'game', 'rpg', 'sticker', 'audio', 
     'imagen', 'maker', 'convertidor', 'nsfw', 'premium', 'jadibot', 'config']
     .map(cat => `${dir}${cat}-${nombre}.js`)
  ).flat()

  let encontrado = false
  let archivoEliminado = ''

  for (let filePath of pluginFiles) {
    if (existsSync(filePath)) {
      try {
        const content = readFileSync(filePath, 'utf8')
        if (content.includes('// Comando agregado automÃ¡ticamente por addcommand')) {
          unlinkSync(filePath)
          delete global.plugins[filePath.split('/').pop()]
          encontrado = true
          archivoEliminado = filePath
          break
        }
      } catch (e) {
        continue
      }
    }
  }

  if (!encontrado) {
    return m.reply(`âŒ No se encontrÃ³ el comando "${nombre}" o no fue creado con addcommand

ğŸ’¡ *Tip:* Usa ${usedPrefix}listcmd para ver comandos disponibles`)
  }

  m.reply(`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       COMANDO ELIMINADO          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… *Comando eliminado exitosamente!*

ğŸ“ *Detalles:*
â€¢ Comando: ${nombre}
â€¢ Archivo: ${archivoEliminado}

ğŸ”„ *El comando ya no estÃ¡ disponible en el menÃº*`)
}

handler.help = ['delcommand', 'delcmd']
handler.tags = ['owner']
handler.command = ['delcommand', 'delcmd', 'eliminarcmd']
handler.rowner = true

export default handler
