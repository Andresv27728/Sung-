
import { writeFileSync, readFileSync, existsSync } from 'fs'

let handler = async (m, { conn, text, args, usedPrefix, command }) => {
  if (!text) {
    return m.reply(`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ADD COMMAND SYSTEM          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ *Uso:* ${usedPrefix + command} <nombre>|<categorÃ­a>|<descripciÃ³n>

ğŸ“Œ *Ejemplo:*
${usedPrefix + command} micomando|fun|Este comando hace algo divertido

ğŸ“‹ *CategorÃ­as disponibles:*
â€¢ main, info, ai, anime, owner
â€¢ grupo, grupo-admin, descargas, tools
â€¢ fun, game, rpg, sticker, audio
â€¢ imagen, maker, convertidor, nsfw
â€¢ premium, jadibot, config

âš ï¸ *Nota:* Solo el owner puede usar este comando`)
  }

  let [nombre, categoria, descripcion] = text.split('|')
  
  if (!nombre || !categoria || !descripcion) {
    return m.reply('âŒ Faltan parÃ¡metros. Usa: nombre|categorÃ­a|descripciÃ³n')
  }

  nombre = nombre.trim().toLowerCase()
  categoria = categoria.trim().toLowerCase()
  descripcion = descripcion.trim()

  // Validar categorÃ­a
  const categoriasValidas = [
    'main', 'info', 'ai', 'anime', 'owner', 'grupo', 'grupo-admin', 
    'descargas', 'tools', 'fun', 'game', 'rpg', 'sticker', 'audio', 
    'imagen', 'maker', 'convertidor', 'nsfw', 'premium', 'jadibot', 'config'
  ]

  if (!categoriasValidas.includes(categoria)) {
    return m.reply(`âŒ CategorÃ­a invÃ¡lida. CategorÃ­as disponibles:\n${categoriasValidas.join(', ')}`)
  }

  // Crear el archivo del plugin
  const fileName = `${categoria}-${nombre}.js`
  const filePath = `plugins/${fileName}`

  if (existsSync(filePath)) {
    return m.reply(`âŒ Ya existe un comando con ese nombre: ${fileName}`)
  }

  const pluginTemplate = `// Comando agregado automÃ¡ticamente por addcommand
// Creado: ${new Date().toLocaleString('es-PE')}

let handler = async (m, { conn, args, usedPrefix, command }) => {
  // AquÃ­ va la lÃ³gica del comando
  m.reply(\`âœ… Comando \${command} ejecutado!\\n\\nğŸ“ DescripciÃ³n: ${descripcion}\\n\\nâš ï¸ Este comando fue creado con addcommand y necesita ser programado.\`)
}

handler.help = ['${nombre}']
handler.tags = ['${categoria}']
handler.command = ['${nombre}']
handler.register = true

export default handler`

  try {
    // Escribir el archivo
    writeFileSync(filePath, pluginTemplate, 'utf8')

    // Recargar plugins
    delete global.plugins[fileName]
    global.plugins[fileName] = (await import(`../${filePath}?update=${Date.now()}`)).default

    m.reply(`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        COMANDO AGREGADO          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… *Comando creado exitosamente!*

ğŸ“ *Detalles:*
â€¢ Nombre: ${nombre}
â€¢ CategorÃ­a: ${categoria}
â€¢ DescripciÃ³n: ${descripcion}
â€¢ Archivo: ${fileName}

ğŸ”„ *El comando ya estÃ¡ disponible en el menÃº*
ğŸ“ *Ãšsalo con:* ${usedPrefix}${nombre}

âš ï¸ *Nota:* El comando necesita ser programado editando el archivo ${fileName}`)

  } catch (error) {
    console.error(error)
    m.reply('âŒ Error al crear el comando: ' + error.message)
  }
}

handler.help = ['addcommand', 'addcmd']
handler.tags = ['owner']
handler.command = ['addcommand', 'addcmd', 'agregarcmd']
handler.rowner = true

export default handler
