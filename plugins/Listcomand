
import { readdirSync, readFileSync } from 'fs'

let handler = async (m, { conn, usedPrefix }) => {
  try {
    const pluginFiles = readdirSync('./plugins')
    const customCommands = []

    for (let file of pluginFiles) {
      if (!file.endsWith('.js')) continue
      
      try {
        const content = readFileSync(`./plugins/${file}`, 'utf8')
        if (content.includes('// Comando agregado automÃ¡ticamente por addcommand')) {
          const plugin = global.plugins[file]
          if (plugin && plugin.help && plugin.tags) {
            customCommands.push({
              file: file,
              command: plugin.help[0] || 'desconocido',
              category: plugin.tags[0] || 'sin categorÃ­a',
              description: content.match(/DescripciÃ³n: (.+)/)?.[1] || 'Sin descripciÃ³n'
            })
          }
        }
      } catch (e) {
        continue
      }
    }

    if (customCommands.length === 0) {
      return m.reply('ğŸ“ No hay comandos personalizados creados con addcommand')
    }

    let text = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       COMANDOS PERSONALIZADOS    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š *Total de comandos:* ${customCommands.length}

`

    customCommands.forEach((cmd, index) => {
      text += `
*${index + 1}.* ğŸ“ *${cmd.command}*
   â€¢ CategorÃ­a: ${cmd.category}
   â€¢ Archivo: ${cmd.file}
   â€¢ Uso: ${usedPrefix}${cmd.command}
   â€¢ DescripciÃ³n: ${cmd.description}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`
    })

    text += `

ğŸ’¡ *Tip:* Usa ${usedPrefix}delcommand <nombre> para eliminar un comando`

    m.reply(text)

  } catch (error) {
    console.error(error)
    m.reply('âŒ Error al listar comandos: ' + error.message)
  }
}

handler.help = ['listcommands', 'listcmd']
handler.tags = ['owner']
handler.command = ['listcommands', 'listcmd', 'comandospersonalizados']
handler.rowner = true

export default handler
